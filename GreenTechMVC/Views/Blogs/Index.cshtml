@using DAL.DTOs.Blog
@{
    ViewData["Title"] = "Blog Tư Vấn";
    var blogs = ViewBag.Blogs as IEnumerable<BlogResponseDTO> ?? new List<BlogResponseDTO>();
    var totalBlogs = ViewBag.TotalBlogs as int? ?? 0;
    var totalPages = ViewBag.TotalPages as int? ?? 1;
    var currentPage = ViewBag.CurrentPage as int? ?? 1;
    var hasPreviousPage = ViewBag.HasPreviousPage as bool? ?? false;
    var hasNextPage = ViewBag.HasNextPage as bool? ?? false;
    var searchTerm = ViewBag.SearchTerm as string ?? "";
}

<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="mb-8">
        <h1 class="text-4xl font-bold text-gray-900 mb-2">Blog Tư Vấn</h1>
        <p class="text-gray-600">Khám phá những bài viết hữu ích về cây xanh và chăm sóc cây cảnh</p>
    </div>

    <!-- Search and Filter -->
    <div class="mb-8 bg-white rounded-lg shadow-md p-6">
        <form method="get" action="@Url.Action("Index", "Blogs")" class="flex flex-wrap gap-4">
            <div class="flex-1 min-w-[250px]">
                <input type="text" name="search" value="@searchTerm" placeholder="Tìm kiếm bài viết..." 
                       class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500">
            </div>
            <button type="submit" class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium">
                <i class="fas fa-search mr-2"></i>Tìm kiếm
            </button>
            @if (!string.IsNullOrEmpty(searchTerm))
            {
                <a href="@Url.Action("Index", "Blogs")" class="px-6 py-2 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-lg font-medium">
                    <i class="fas fa-times mr-2"></i>Xóa bộ lọc
                </a>
            }
        </form>
    </div>

    <!-- Blogs Grid -->
    @if (blogs.Any())
    {
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            @foreach (var blog in blogs)
            {
                <article class="bg-white rounded-lg shadow-md overflow-hidden transition-all hover:shadow-xl">
                    <a asp-action="Details" asp-route-id="@blog.Id" asp-route-slug="@blog.Slug">
                        <div class="relative h-48 overflow-hidden">
                            <img src="@(!string.IsNullOrEmpty(blog.FeaturedImage) ? blog.FeaturedImage : "/images/no-image.png")" 
                                 alt="@blog.Title" 
                                 class="w-full h-full object-cover transition-transform hover:scale-110">
                            @if (blog.IsFeatured)
                            {
                                <span class="absolute top-2 right-2 bg-red-500 text-white px-2 py-1 rounded text-xs font-semibold">
                                    Nổi bật
                                </span>
                            }
                        </div>
                        <div class="p-6">
                            <div class="flex items-center gap-2 text-xs text-gray-500 mb-2">
                                <span><i class="far fa-calendar mr-1"></i>@blog.PublishedAt?.ToString("dd/MM/yyyy")</span>
                                @if (!string.IsNullOrEmpty(blog.AuthorName))
                                {
                                    <span class="mx-2">•</span>
                                    <span><i class="far fa-user mr-1"></i>@blog.AuthorName</span>
                                }
                                @if (blog.ViewCount > 0)
                                {
                                    <span class="mx-2">•</span>
                                    <span><i class="far fa-eye mr-1"></i>@blog.ViewCount lượt xem</span>
                                }
                            </div>
                            <h2 class="text-xl font-bold text-gray-900 mb-2 line-clamp-2">@blog.Title</h2>
                            <p class="text-gray-600 line-clamp-3 mb-4">@blog.Excerpt</p>
                            <div class="flex items-center justify-between">
                                <span class="text-green-600 font-medium hover:text-green-700">
                                    Đọc thêm <i class="fas fa-arrow-right ml-1"></i>
                                </span>
                                @if (!string.IsNullOrEmpty(blog.CategoryName))
                                {
                                    <span class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-medium">
                                        @blog.CategoryName
                                    </span>
                                }
                            </div>
                        </div>
                    </a>
                </article>
            }
        </div>

        <!-- Pagination -->
        @if (totalPages > 1)
        {
            <div class="flex items-center justify-center gap-2">
                @if (hasPreviousPage)
                {
                    <a href="@Url.Action("Index", "Blogs", new { page = currentPage - 1, search = searchTerm })" 
                       class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                        <i class="fas fa-chevron-left"></i> Trước
                    </a>
                }
                
                @for (int i = Math.Max(1, currentPage - 2); i <= Math.Min(totalPages, currentPage + 2); i++)
                {
                    if (i == currentPage)
                    {
                        <span class="px-4 py-2 bg-green-600 text-white rounded-lg font-medium">@i</span>
                    }
                    else
                    {
                        <a href="@Url.Action("Index", "Blogs", new { page = i, search = searchTerm })" 
                           class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                            @i
                        </a>
                    }
                }

                @if (hasNextPage)
                {
                    <a href="@Url.Action("Index", "Blogs", new { page = currentPage + 1, search = searchTerm })" 
                       class="px-4 py-2 bg-white border border-gray-300 rounded-lg hover:bg-gray-50">
                        Sau <i class="fas fa-chevron-right"></i>
                    </a>
                }
            </div>
        }
    }
    else
    {
        <div class="bg-white rounded-lg shadow-md p-12 text-center">
            <i class="fas fa-file-alt text-6xl text-gray-300 mb-4"></i>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">Không tìm thấy bài viết</h3>
            <p class="text-gray-500">@(string.IsNullOrEmpty(searchTerm) ? "Chưa có bài viết nào." : "Không có bài viết nào phù hợp với từ khóa tìm kiếm.")</p>
        </div>
    }
</div>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
</style>

